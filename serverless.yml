service: valter-api

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  architecture: x86_64
  region: us-east-1
  memorySize: 512
  timeout: 29
  environment:
    NODE_ENV: production
    IS_LAMBDA: 'true'
    DATABASE_URL: ${env:DATABASE_URL}
    DIRECT_URL: ${env:DIRECT_URL}
    JWT_SECRET: ${env:JWT_SECRET}
    JWT_REFRESH_SECRET: ${env:JWT_REFRESH_SECRET}
    EXPIRES_API_SERVICE_URL: ${env:EXPIRES_API_SERVICE_URL}

package:
  patterns:
    - 'dist/**'
    - 'node_modules/**'
    - 'prisma/schema.prisma'
    - 'node_modules/.prisma/**'
    - 'node_modules/@prisma/client/**'
    - 'node_modules/@prisma/engines/**'
    - '!node_modules/.cache/**'
    - '!node_modules/typescript/**'
    - '!node_modules/@swc/**'
    - '!node_modules/@nestjs/cli/**'
    - '!node_modules/@nestjs/schematics/**'
    - '!node_modules/@types/**'
    - '!node_modules/prettier/**'
    - '!node_modules/eslint/**'
    - '!node_modules/jest/**'
    - '!node_modules/ts-jest/**'
    - '!node_modules/supertest/**'
    - '!**/*.ts'
    - '!**/*.map'
    - '!test/**'
    - '!src/**'
    - '!.git/**'
    - '!.github/**'
    - '!ci-cd/**'
    - '!.claude/**'
    - '!coverage/**'

functions:
  api:
    handler: dist/src/lambda.handler
    events:
      - httpApi: '*'

  notifyExpires:
    handler: dist/src/lambda.cronHandler
    memorySize: 256
    timeout: 60
    events:
      - schedule:
          rate: rate(1 minute)
          enabled: true
